<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e3c72">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Pro Football Training Attendance System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --success-color: #2e8b57;
            --warning-color: #daa520;
            --danger-color: #cd5c5c;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --gray-color: #666;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --touch-target-min: 44px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }
        
        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 20px;
            padding-left: max(15px, env(safe-area-inset-left));
            padding-right: max(15px, env(safe-area-inset-right));
            padding-bottom: max(15px, env(safe-area-inset-bottom));
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px 40px;
            width: 100%;
            max-width: 480px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 10px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .login-logo i {
            font-size: 4rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        
        .login-logo h1 {
            color: var(--primary-color);
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .login-logo p {
            color: var(--gray-color);
            font-size: 1rem;
        }
        
        .login-form .form-group {
            margin-bottom: 25px;
        }
        
        .login-form label {
            display: block;
            margin-bottom: 10px;
            color: var(--dark-color);
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .login-form input {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            font-size: 1rem;
            transition: var(--transition);
            background-color: #f8fafc;
            min-height: var(--touch-target-min);
        }
        
        .login-form input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
            background-color: white;
        }
        
        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
            min-height: var(--touch-target-min);
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(30, 60, 114, 0.3);
        }
        
        .login-error {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: 12px;
            text-align: center;
            display: none;
            padding: 12px;
            background-color: #fee;
            border-radius: 8px;
            border-left: 4px solid var(--danger-color);
        }
        
        .demo-credentials {
            margin-top: 30px;
            text-align: center;
            padding: 15px;
            background-color: #f1f5f9;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        /* Dashboard Styles */
        .dashboard-container {
            display: none;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            padding-left: max(5px, env(safe-area-inset-left));
            padding-right: max(5px, env(safe-area-inset-right));
            padding-bottom: max(10px, env(safe-area-inset-bottom));
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M10,50 Q25,25 50,10 Q75,25 90,50 Q75,75 50,90 Q25,75 10,50" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2"/></svg>') repeat;
            opacity: 0.3;
        }
        
        .header-left h1 {
            font-size: 2.4rem;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 700;
        }
        .logo-img {
            height: 90px;
        }
        
        .header-left i {
            font-size: 2.8rem;
            color: #ffcc00;
        }
        
        .header-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: rgba(255, 255, 255, 0.15);
            padding: 12px 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fff 0%, #f1f5f9 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .logout-btn {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            min-height: var(--touch-target-min);
        }
        
        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.25);
        }
        
        .date-info {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Stats Container */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
            border: 1px solid #f1f5f9;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }
        
        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
        }
        
        .icon-1 { background: linear-gradient(135deg, #4a6fa5 0%, #3a5f95 100%); }
        .icon-2 { background: linear-gradient(135deg, #2e8b57 0%, #1e7b47 100%); }
        .icon-3 { background: linear-gradient(135deg, #daa520 0%, #ca9520 100%); }
        .icon-4 { background: linear-gradient(135deg, #cd5c5c 0%, #bd4c4c 100%); }
        
        .stat-info h3 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .stat-info p {
            color: var(--gray-color);
            font-size: 0.95rem;
        }
        
        /* Tabs */
        .dashboard-tabs {
            display: flex;
            background-color: white;
            border-radius: 16px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border: 1px solid #f1f5f9;
        }
        
        .tab {
            flex: 1;
            padding: 22px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            color: var(--gray-color);
            position: relative;
            font-size: 1.05rem;
            min-height: var(--touch-target-min);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab:hover:not(.active) {
            background-color: #f8fafc;
            color: var(--primary-color);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background-color: white;
            border-radius: 2px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Attendance Tab */
        .dashboard-card {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            border: 1px solid #f1f5f9;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }
        
        .card-header h2 {
            color: var(--primary-color);
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .card-label {
            color: var(--gray-color);
            font-size: 0.95rem;
        }
        
        /* Attendance Controls */
        .attendance-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
            background-color: #f8fafc;
            padding: 25px;
            border-radius: 16px;
        }
        
        .training-date {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .training-date input {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            font-size: 1rem;
            font-weight: 500;
            min-height: var(--touch-target-min);
        }
        
        .session-type {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            background-color: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .session-btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            background-color: #f1f5f9;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            color: var(--gray-color);
            min-height: var(--touch-target-min);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .session-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.2);
        }
        
        .save-attendance-btn {
            background: linear-gradient(135deg, var(--success-color) 0%, #1e7b47 100%);
            color: white;
            padding: 14px 32px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            font-size: 1rem;
            min-height: var(--touch-target-min);
        }
        
        .save-attendance-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 139, 87, 0.3);
        }
        
        /* Player Cards */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }
        
        .player-card {
            background-color: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
            border: 1px solid #f1f5f9;
            position: relative;
        }
        
        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
            z-index: 1000;
        }
        
        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .player-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .player-info {
            flex: 1;
            min-width: 0;
        }
        
        .player-name {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .player-position {
            color: var(--primary-color);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: inline-block;
            padding: 4px 12px;
            background-color: #e0e7ff;
            border-radius: 20px;
        }
        
        .player-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-available { background-color: var(--success-color); }
        .status-unavailable { background-color: var(--danger-color); }
        
        /* Action Button */
        .player-action-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            z-index: 2;
        }
        
        .player-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }
        
        /* Attendance Modal */
        .attendance-modal {
            position: absolute;
            top: 60px;
            right: 20px;
            background-color: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 10;
            display: none;
            min-width: 200px;
            border: 1px solid #e2e8f0;
        }
        
        .attendance-modal.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .attendance-modal h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .attendance-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .attendance-btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            min-height: var(--touch-target-min);
        }
        
        .btn-present {
            background-color: #e6f4ea;
            color: #137333;
            border: 2px solid #c6e7d2;
        }
        
        .btn-present.active {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        
        .btn-absent {
            background-color: #fce8e6;
            color: #c5221f;
            border: 2px solid #f4c7c7;
        }
        
        .btn-absent.active {
            background-color: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }
        
        .btn-late {
            background-color: #fef7e0;
            color: #b06000;
            border: 2px solid #f5e6c7;
        }
        
        .btn-late.active {
            background-color: var(--warning-color);
            color: white;
            border-color: var(--warning-color);
        }
        
        /* Today's Attendance Section */
        .today-attendance-section {
            margin-top: 40px;
            background-color: #f8fafc;
            border-radius: 20px;
            padding: 30px;
        }
        
        .today-attendance-section h3 {
            color: var(--primary-color);
            font-size: 1.4rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .attendance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .summary-card .count {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .summary-present .count { color: var(--success-color); }
        .summary-absent .count { color: var(--danger-color); }
        .summary-late .count { color: var(--warning-color); }
        
        /* All Attendance Section */
        .all-attendance-section {
            margin-top: 40px;
        }
        
        .filter-controls {
            background-color: #f8fafc;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            font-size: 0.95rem;
            background-color: white;
            transition: var(--transition);
            min-height: var(--touch-target-min);
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
        }
        
        .filter-actions {
            display: flex;
            gap: 15px;
            margin-left: auto;
        }
        
        .filter-btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: var(--touch-target-min);
        }
        
        .apply-filter {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }
        
        .apply-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.2);
        }
        
        .reset-filter {
            background-color: #f1f5f9;
            color: var(--dark-color);
        }
        
        .reset-filter:hover {
            background-color: #e2e8f0;
        }
        
        .attendance-table-container {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            overflow-x: auto;
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
        }
        
        .attendance-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1000px;
        }
        
        .attendance-table th {
            background-color: #f1f5f9;
            color: var(--primary-color);
            text-align: left;
            padding: 18px;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 0;
        }
        
        .attendance-table td {
            padding: 18px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .attendance-table tbody tr:hover {
            background-color: #f8fafc;
        }
        
        .attendance-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .datetime-cell {
            min-width: 180px;
        }
        
        .datetime-display {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .date-part {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .time-part {
            font-size: 0.85rem;
            color: var(--gray-color);
            background-color: #f8fafc;
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
        }
        
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            display: inline-block;
        }
        
        .status-present {
            background-color: #e6f4ea;
            color: #137333;
        }
        
        .status-absent {
            background-color: #fce8e6;
            color: #c5221f;
        }
        
        .status-late {
            background-color: #fef7e0;
            color: #b06000;
        }
        
        .session-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .session-morning {
            background-color: #e0f2fe;
            color: #0369a1;
        }
        
        .session-afternoon {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .session-evening {
            background-color: #f3e8ff;
            color: #7c3aed;
        }
        
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-color);
            font-size: 1.1rem;
        }
        
        .no-data i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* Player Management Tab - MOBILE-FRIENDLY DESIGN */
        .player-management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .add-player-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 14px 32px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            min-height: var(--touch-target-min);
        }
        
        .add-player-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 60, 114, 0.3);
        }
        
        /* Desktop Table View */
        .players-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            background-color: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        .players-table th {
            background-color: #f1f5f9;
            color: var(--primary-color);
            text-align: left;
            padding: 20px;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .players-table td {
            padding: 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .players-table tr:hover {
            background-color: #f8fafc;
        }
        
        .players-table tr:last-child td {
            border-bottom: none;
        }
        
        /* Mobile Card View */
        .players-grid-view {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .player-management-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid #f1f5f9;
            transition: var(--transition);
            position: relative;
        }
        
        .player-management-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }
        
        .player-management-header-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .player-management-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .player-management-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .player-management-info {
            flex: 1;
            min-width: 0;
        }
        
        .player-management-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 4px;
            color: var(--dark-color);
        }
        
        .player-management-details {
            font-size: 0.8rem;
            color: var(--gray-color);
        }
        
        .player-management-details strong {
            color: var(--primary-color);
        }
        
        .player-management-card-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .player-management-detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .player-management-label {
            font-size: 0.75rem;
            color: var(--gray-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .player-management-value {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.9rem;
        }
        
        .player-management-availability {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background-color: #f8fafc;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .player-management-attendance {
            margin-bottom: 20px;
        }
        
        .player-management-attendance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .player-management-attendance-rate {
            font-weight: 700;
            color: var(--success-color);
            font-size: 0.9rem;
        }
        
        .player-management-progress-bar {
            height: 8px;
            background-color: #f1f5f9;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .player-management-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .player-management-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }
        
        .player-management-edit-btn,
        .player-management-delete-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
            min-height: 44px;
        }
        
        .player-management-edit-btn {
            background-color: #e0e7ff;
            color: var(--primary-color);
        }
        
        .player-management-edit-btn:hover {
            background-color: #d0d9ff;
        }
        
        .player-management-delete-btn {
            background-color: #fce8e6;
            color: var(--danger-color);
        }
        
        .player-management-delete-btn:hover {
            background-color: #fad8d6;
        }
        
        .player-management-search-bar {
            margin-bottom: 20px;
        }
        
        .player-management-search-input {
            width: 100%;
            padding: 14px 20px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            font-size: 1rem;
            background-color: white;
            transition: var(--transition);
            min-height: var(--touch-target-min);
        }
        
        .player-management-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
        }
        
        .player-management-sort-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .player-management-sort-btn {
            padding: 10px 16px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            background-color: white;
            color: var(--gray-color);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 0.85rem;
        }
        
        .player-management-sort-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .player-management-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-color);
            font-size: 1.1rem;
        }
        
        .player-management-empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .availability-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--success-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .edit-btn, .delete-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            min-height: var(--touch-target-min);
        }
        
        .edit-btn {
            background-color: #e0e7ff;
            color: var(--primary-color);
        }
        
        .edit-btn:hover {
            background-color: #d0d9ff;
        }
        
        .delete-btn {
            background-color: #fce8e6;
            color: var(--danger-color);
        }
        
        .delete-btn:hover {
            background-color: #fad8d6;
        }
        
        /* Analytics Tab */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            height: 320px;
            position: relative;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid #f1f5f9;
            animation: modalSlideIn 0.4s ease;
            max-height: 90vh;
            overflow-y: auto;
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .modal-header h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--gray-color);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            background-color: #f1f5f9;
        }
        
        .modal-form .form-group {
            margin-bottom: 25px;
        }
        
        .modal-form label {
            display: block;
            margin-bottom: 10px;
            color: var(--dark-color);
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .modal-form input, .modal-form select {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            font-size: 1rem;
            transition: var(--transition);
            background-color: #f8fafc;
            min-height: var(--touch-target-min);
        }
        
        .modal-form input:focus, .modal-form select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
            background-color: white;
        }
        
        .image-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: #f8fafc;
        }
        
        .image-upload:hover {
            border-color: var(--primary-color);
            background-color: #f1f5f9;
        }
        
        .image-upload i {
            font-size: 3rem;
            color: #94a3b8;
            margin-bottom: 15px;
        }
        
        .image-upload p {
            color: var(--gray-color);
            margin-bottom: 10px;
        }
        
        .image-upload span {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 40px;
        }
        
        .cancel-btn {
            padding: 14px 28px;
            background-color: #f1f5f9;
            color: var(--dark-color);
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-height: var(--touch-target-min);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cancel-btn:hover {
            background-color: #e2e8f0;
        }

        button:disabled{
            cursor: not-allowed !important;
            opacity: 0.5
        }
        
        .save-btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-height: var(--touch-target-min);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 60, 114, 0.3);
        }
        
        .dashboard-footer {
            text-align: center;
            padding: 30px;
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-top: 40px;
            border-top: 2px solid #f1f5f9;
        }

        .attendance{
            overflow: auto !important;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f1f5f9;
        }
        
        .pagination-btn {
            padding: 10px 18px;
            background-color: #f1f5f9;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: var(--dark-color);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            min-height: var(--touch-target-min);
        }
        
        .pagination-btn:hover:not(:disabled) {
            background-color: #e2e8f0;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: var(--gray-color);
            font-size: 0.9rem;
        }
        
        /* Mobile-specific improvements */
        @media (max-width: 768px) {
            /* Base mobile adjustments */
            body {
                font-size: 14px;
            }
            
            .dashboard-container {
                padding: 10px 5px;
            }
            
            /* Login page mobile optimization */
            .login-container {
                padding: 15px;
            }
            
            .login-box {
                padding: 30px 20px;
                margin: 10px;
                max-width: 100%;
            }
            
            .login-logo h1 {
                font-size: 1.5rem;
                line-height: 1.3;
            }
            
            .login-logo i {
                font-size: 3rem;
            }
            
            .logo-img {
                height: 70px;
            }
            
            /* Header mobile optimization */
            .dashboard-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 20px 15px;
                border-radius: 15px;
                margin-bottom: 20px;
            }
            
            .header-left h1 {
                font-size: 1.3rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .header-subtitle {
                font-size: 0.85rem;
                margin-top: 5px;
            }
            
            .header-right {
                flex-direction: column;
                width: 100%;
                gap: 15px;
            }
            
            .user-info {
                width: 100%;
                justify-content: center;
                padding: 10px 15px;
            }
            
            .logout-btn, .date-info {
                width: 100%;
                justify-content: center;
                padding: 12px 15px;
            }
            
            /* Stats container mobile grid */
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .stat-card {
                padding: 15px;
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .stat-info h3 {
                font-size: 1.5rem;
            }
            
            /* Tabs mobile optimization */
            .dashboard-tabs {
                flex-wrap: wrap;
                border-radius: 12px;
                margin-bottom: 20px;
                position: sticky;
                top: 0;
                z-index: 100;
                background: white;
            }
            
            .tab {
                padding: 16px 10px;
                font-size: 0.9rem;
                min-width: 50%;
                border-bottom: 1px solid #f1f5f9;
            }
            
            .tab:nth-child(odd) {
                border-right: 1px solid #f1f5f9;
            }
            
            .tab.active::after {
                width: 30px;
                height: 3px;
            }
            
            /* Attendance tab mobile optimization */
            .dashboard-card {
                padding: 20px 15px;
                border-radius: 15px;
                margin-bottom: 20px;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                margin-bottom: 20px;
                padding-bottom: 15px;
            }
            
            .card-header h2 {
                font-size: 1.2rem;
            }
            
            .card-value {
                font-size: 1.8rem;
                align-self: flex-start;
            }
            
            .attendance-controls {
                flex-direction: column;
                padding: 15px;
                gap: 15px;
                border-radius: 12px;
            }
            
            .training-date {
                width: 100%;
                justify-content: space-between;
            }
            
            .training-date input {
                width: auto;
                flex-grow: 1;
                max-width: 200px;
            }
            
            .session-type {
                width: 100%;
                justify-content: center;
                padding: 5px;
                gap: 8px;
            }
            
            .session-btn {
                padding: 10px 15px;
                font-size: 0.85rem;
                flex: 1;
                min-width: 80px;
            }
            
            .save-attendance-btn {
                width: 100%;
                justify-content: center;
                padding: 16px;
            }
            
            /* Players grid mobile optimization */
            .players-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .player-card {
                padding: 20px;
                gap: 15px;
            }
            
            .player-avatar {
                width: 60px;
                height: 60px;
                font-size: 1.4rem;
            }
            
            .player-info {
                min-width: 0;
                flex: 1;
            }
            
            .player-name {
                font-size: 1.1rem;
            }
            
            .player-position {
                font-size: 0.8rem;
            }
            
            .player-action-btn {
                width: 36px;
                height: 36px;
                font-size: 0.9rem;
            }
            
            /* Attendance modal mobile optimization */
            .attendance-modal {
                min-width: 180px;
                right: 10px;
                top: 50px;
                padding: 15px;
            }
            
            .attendance-btn {
                padding: 12px 15px;
                font-size: 0.85rem;
            }
            
            /* Today's attendance mobile optimization */
            .today-attendance-section {
                padding: 20px 15px;
                border-radius: 15px;
                margin-top: 30px;
            }
            
            .attendance-summary {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .summary-card {
                padding: 15px 10px;
            }
            
            .summary-card .count {
                font-size: 1.8rem;
            }
            
            /* All attendance tab mobile optimization */
            .filter-controls {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .filter-actions {
                flex-direction: row;
                width: 100%;
                margin-left: 0;
                justify-content: space-between;
            }
            
            .filter-btn {
                flex: 1;
                justify-content: center;
                padding: 14px 10px;
                font-size: 0.85rem;
            }
            
            .attendance-table-container {
                padding: 20px 10px;
            }
            
            .attendance-table {
                min-width: 700px;
                font-size: 0.85rem;
            }
            
            .attendance-table th,
            .attendance-table td {
                padding: 12px 8px;
            }
            
            .attendance-table th:nth-child(4),
            .attendance-table td:nth-child(4) {
                display: none;
            }
            
            /* Pagination mobile optimization */
            .pagination {
                flex-wrap: wrap;
                gap: 8px;
                padding-top: 15px;
                margin-top: 20px;
            }
            
            .pagination-btn {
                padding: 10px 15px;
                font-size: 0.85rem;
                flex: 1;
                justify-content: center;
            }
            
            .pagination-info {
                width: 100%;
                text-align: center;
                order: -1;
                margin-bottom: 10px;
            }
            
            /* Player Management Tab - MOBILE OPTIMIZATION */
            .players-table {
                display: none !important;
            }
            
            .players-grid-view {
                display: grid !important;
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .player-management-card {
                padding: 15px;
            }
            
            .player-management-header-row {
                gap: 12px;
                margin-bottom: 12px;
                padding-bottom: 12px;
            }
            
            .player-management-avatar {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .player-management-name {
                font-size: 1rem;
            }
            
            .player-management-details {
                font-size: 0.75rem;
            }
            
            .player-management-card-content {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 15px;
            }
            
            .player-management-detail-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid #f1f5f9;
            }
            
            .player-management-detail-item:last-child {
                border-bottom: none;
            }
            
            .player-management-label {
                font-size: 0.7rem;
            }
            
            .player-management-value {
                font-size: 0.85rem;
            }
            
            .player-management-availability {
                padding: 10px;
                margin-bottom: 15px;
            }
            
            .player-management-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .player-management-edit-btn,
            .player-management-delete-btn {
                width: 100%;
                padding: 14px;
            }
            
            .player-management-sort-controls {
                overflow-x: auto;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            
            .player-management-sort-controls::-webkit-scrollbar {
                display: none;
            }
            
            .player-management-sort-btn {
                padding: 12px 18px;
                font-size: 0.85rem;
            }
            
            .player-management-search-input {
                padding: 16px;
                font-size: 16px;
            }
            
            /* Analytics tab mobile optimization */
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            /* Modal mobile optimization */
            .modal-content {
                width: 95%;
                padding: 25px 20px;
                margin: 10px;
                max-height: 85vh;
            }
            
            .modal-header h2 {
                font-size: 1.4rem;
            }
            
            .image-upload {
                padding: 20px;
            }
            
            .modal-buttons {
                flex-direction: column-reverse;
                gap: 10px;
            }
            
            .cancel-btn, .save-btn {
                width: 100%;
                justify-content: center;
            }
            
            /* Footer mobile optimization */
            .dashboard-footer {
                padding: 20px 15px;
                font-size: 0.8rem;
            }
            
            /* Touch-friendly improvements */
            button, 
            .tab,
            .player-card,
            .attendance-btn,
            .filter-btn,
            .edit-btn,
            .delete-btn,
            .player-management-edit-btn,
            .player-management-delete-btn {
                min-height: 44px;
            }
            
            input,
            select {
                min-height: 44px;
                font-size: 16px;
            }
            
            /* Improve scroll performance */
            .attendance-table-container,
            .dashboard-card,
            .players-table,
            .modal-content {
                -webkit-overflow-scrolling: touch;
            }
            
            /* Mobile hover states */
            .tab:active,
            button:active,
            .player-card:active,
            .player-management-card:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
            
            /* Disable hover effects on touch devices */
            @media (hover: none) {
                .player-card:hover,
                .stat-card:hover,
                .player-management-card:hover {
                    transform: none;
                    box-shadow: var(--card-shadow);
                }
                
                .logout-btn:hover,
                .save-attendance-btn:hover,
                .add-player-btn:hover,
                .filter-btn:hover,
                .edit-btn:hover,
                .delete-btn:hover,
                .player-management-edit-btn:hover,
                .player-management-delete-btn:hover {
                    transform: none;
                    box-shadow: none;
                }
            }
        }
        
        /* Extra small devices (phones, less than 576px) */
        @media (max-width: 576px) {
            .stats-container {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .dashboard-tabs {
                flex-direction: column;
            }
            
            .tab {
                min-width: 100%;
                border-right: none !important;
                border-bottom: 1px solid #f1f5f9;
            }
            
            .tab:last-child {
                border-bottom: none;
            }
            
            .tab.active::after {
                left: 0;
                transform: none;
                width: 100%;
                bottom: -1px;
                height: 3px;
                border-radius: 0;
            }
            
            .attendance-summary {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .summary-card {
                padding: 20px;
            }
            
            .filter-actions {
                flex-direction: column;
            }
            
            .pagination-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
        }
        
        /* Tablet portrait optimizations (768px - 992px) */
        @media (min-width: 768px) and (max-width: 992px) {
            .dashboard-container {
                padding: 15px;
            }
            
            .players-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 280px;
            }
            
            .players-grid-view {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Desktop view - show table, hide cards */
        @media (min-width: 769px) {
            .players-table {
                display: table !important;
            }
            
            .players-grid-view {
                display: none !important;
            }
        }
        
        /* Landscape mode optimizations */
        @media (max-height: 600px) and (orientation: landscape) {
            .login-container {
                padding: 10px;
            }
            
            .login-box {
                padding: 20px;
                max-width: 90%;
            }
            
            .login-logo {
                margin-bottom: 20px;
            }
            
            .login-logo h1 {
                font-size: 1.3rem;
            }
            
            .logo-img {
                height: 50px;
            }
            
            .modal-content {
                max-height: 85vh;
                overflow-y: auto;
            }
        }
        
        /* High DPI (Retina) display optimizations */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .stat-icon,
            .player-avatar,
            .user-avatar,
            .player-management-avatar {
                -webkit-backface-visibility: hidden;
                backface-visibility: hidden;
            }
        }
        
        /* iOS-specific adjustments */
        @supports (-webkit-touch-callout: none) {
            input, select {
                -webkit-appearance: none;
                border-radius: 12px;
            }
        }
        
        /* Loading animation */
        .loading {
            position: relative;
            color: transparent !important;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--light-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile navigation improvement */
        html {
            scroll-behavior: smooth;
        }
        
        /* Safe area support */
        @supports (padding: max(0px)) {
            .dashboard-container,
            .login-container {
                padding-left: max(10px, env(safe-area-inset-left));
                padding-right: max(10px, env(safe-area-inset-right));
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
        }
        
        /* Accessibility improvements */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        .tab:focus-visible {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        /* Hide scrollbar on mobile for better UX */
        @media (max-width: 768px) {
            .attendance-table-container::-webkit-scrollbar,
            .modal-content::-webkit-scrollbar,
            .player-management-sort-controls::-webkit-scrollbar {
                display: none;
            }
            
            .attendance-table-container,
            .modal-content,
            .player-management-sort-controls {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="login-container">
        <div class="login-box">
            <div class="login-logo">
                <img src="telu logo png.png" class="logo-img" alt="">
                <h1>Telu Football Club Training System</h1>
                <p>Professional player attendance tracking platform</p>
            </div>
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <div class="login-error" id="login-error">
                    <i class="fas fa-exclamation-circle"></i> Invalid credentials
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login to Dashboard
                </button>
            </form>
            <div class="demo-credentials">
                
            </div>
        </div>
    </div>
    
    <!-- Dashboard -->
    <div class="dashboard-container" id="dashboard-container">
        <header class="dashboard-header">
            <div class="header-left">
                <h1><img src="/telu logo png.png" class="logo-img"> Telu Football Club Training System</h1>
                <p class="header-subtitle">Professional player attendance tracking and management</p>
                <div class="date-info">
                    <i class="far fa-calendar-alt"></i>
                    <span id="current-date">Loading...</span>
                </div>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">C</div>
                    <div>
                        <div id="user-name">Coach Alex Ferguson</div>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Head Coach</div>
                    </div>
                </div>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>
        
        <!-- Statistics -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon icon-1">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3 id="total-players">..</h3>
                    <p>Total Players</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon icon-2">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-info">
                    <h3 id="attendance-rate">..%</h3>
                    <p>Training Attendance Rate</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon icon-3">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stat-info">
                    <h3 id="available-players">...</h3>
                    <p>Always Available Players</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon icon-4">
                    <i class="fas fa-running"></i>
                </div>
                <div class="stat-info">
                    <h3 id="sessions-month">..</h3>
                    <p>Training Sessions This Month</p>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="dashboard-tabs">
            <div class="tab active" data-tab="attendance">
                <i class="fas fa-clipboard-check"></i> <span class="tab-text">Training Attendance</span>
            </div>
            <div class="tab" data-tab="attendance-history">
                <i class="fas fa-history"></i> <span class="tab-text">All Attendance</span>
            </div>
            <div class="tab" data-tab="players">
                <i class="fas fa-user-friends"></i> <span class="tab-text">Player Management</span>
            </div>
            <div class="tab" data-tab="analytics">
                <i class="fas fa-chart-line"></i> <span class="tab-text">Analytics</span>
            </div>
        </div>
        
        <!-- Attendance Tab -->
        <div class="tab-content active" id="attendance-tab">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><i class="fas fa-clipboard-check"></i> Mark Training Attendance</h2>
                    <div>
                        <span class="card-label">Current Session</span>
                        <span class="card-value" id="session-type">Morning</span>
                    </div>
                </div>
                
                <div class="attendance-controls">
                    <div class="training-date">
                        <label for="training-date">Training Date:</label>
                        <input type="date" id="training-date" value="">
                    </div>
                    
                    <div class="session-type">
                        <button class="session-btn active" data-session="morning">
                            <i class="fas fa-sun"></i> Morning
                        </button>
                        <button class="session-btn" data-session="afternoon">
                            <i class="fas fa-cloud-sun"></i> Afternoon
                        </button>
                        <button class="session-btn" data-session="evening">
                            <i class="fas fa-moon"></i> Evening
                        </button>
                    </div>
                    
                    <button class="save-attendance-btn" id="save-attendance-btn">
                        <i class="fas fa-save"></i> Save Attendance
                    </button>
                </div>
                
                <div class="players-grid" id="attendance-players-grid">
                    <!-- Player cards will be inserted here -->
                </div>
                
                <!-- Today's Attendance Summary -->
                <div class="today-attendance-section" id="today-attendance-section" style="display: none;">
                    <h3><i class="fas fa-chart-pie"></i> Today's Attendance Summary</h3>
                    
                    <div class="attendance-summary">
                        <div class="summary-card summary-present">
                            <div class="count" id="present-count">0</div>
                            <div class="label">Players Present</div>
                        </div>
                        <div class="summary-card summary-absent">
                            <div class="count" id="absent-count">0</div>
                            <div class="label">Players Absent</div>
                        </div>
                        <div class="summary-card summary-late">
                            <div class="count" id="late-count">0</div>
                            <div class="label">Players Late</div>
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom: 15px; color: var(--primary-color);">
                        <i class="fas fa-users"></i> Players Who Attended Today
                    </h4>
                    <div class="attendance" id="today-attendance-grid">
                        <!-- Today's attendance will be shown here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- All Attendance Tab -->
        <div class="tab-content" id="attendance-history-tab">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> All Attendance Records</h2>
                    <div>
                        <span class="card-label">Total Records</span>
                        <span class="card-value" id="total-records">0</span>
                    </div>
                </div>
                
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="filter-date">Filter by Date</label>
                        <input type="date" id="filter-date">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-session">Filter by Session</label>
                        <select id="filter-session">
                            <option value="">All Sessions</option>
                            <option value="morning">Morning</option>
                            <option value="afternoon">Afternoon</option>
                            <option value="evening">Evening</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-player">Filter by Player</label>
                        <select id="filter-player">
                            <option value="">All Players</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-status">Filter by Status</label>
                        <select id="filter-status">
                            <option value="">All Statuses</option>
                            <option value="present">Present</option>
                            <option value="absent">Absent</option>
                            <option value="late">Late</option>
                        </select>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="filter-btn apply-filter" id="apply-filter">
                            <i class="fas fa-filter"></i> Apply Filters
                        </button>
                        <button class="filter-btn reset-filter" id="reset-filter">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>
                
                <div class="attendance-table-container">
                    <table class="attendance-table" id="all-attendance-table">
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Session</th>
                                <th>Player</th>
                                <th>Position</th>
                                <th>Jersey No.</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-table-body">
                            <!-- Attendance records will be inserted here -->
                        </tbody>
                    </table>
                    
                    <div class="no-data" id="no-attendance-data" style="display: none;">
                        <i class="fas fa-clipboard-list"></i>
                        <p>No attendance records found</p>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="pagination" id="pagination" style="display: none;">
                        <button class="pagination-btn" id="prev-page" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span class="pagination-info" id="page-info">Page 1 of 1</span>
                        <button class="pagination-btn" id="next-page" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Player Management Tab - MOBILE-FRIENDLY VERSION -->
        <div class="tab-content" id="players-tab">
            <div class="dashboard-card">
                <div class="player-management-header">
                    <h2><i class="fas fa-user-friends"></i> Player Roster Management</h2>
                    <button class="add-player-btn" id="add-player-btn">
                        <i class="fas fa-plus"></i> Add New Player
                    </button>
                </div>
                
                <!-- Search Bar for Mobile -->
                <div class="player-management-search-bar" id="player-search-container">
                    <input type="text" class="player-management-search-input" 
                           placeholder="Search players by name, position, or jersey number..." 
                           id="player-search-input">
                </div>
                
                <!-- Sort Controls for Mobile -->
                <div class="player-management-sort-controls" id="player-sort-controls">
                    <button class="player-management-sort-btn active" data-sort="name">
                        <i class="fas fa-sort-alpha-down"></i> Name
                    </button>
                    <button class="player-management-sort-btn" data-sort="position">
                        <i class="fas fa-futbol"></i> Position
                    </button>
                    <button class="player-management-sort-btn" data-sort="jersey">
                        <i class="fas fa-hashtag"></i> Jersey
                    </button>
                    <button class="player-management-sort-btn" data-sort="attendance">
                        <i class="fas fa-chart-line"></i> Attendance
                    </button>
                    <button class="player-management-sort-btn" data-sort="available">
                        <i class="fas fa-user-check"></i> Availability
                    </button>
                </div>
                
                <!-- Desktop Table View -->
                <table class="players-table" id="players-table-desktop">
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Position</th>
                            <th>Jersey No.</th>
                            <th>Always Available</th>
                            <th>Attendance Rate</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="players-table-body">
                        <!-- Players will be inserted here -->
                    </tbody>
                </table>
                
                <!-- Mobile Card View -->
                <div class="players-grid-view" id="players-grid-view">
                    <!-- Player cards will be inserted here -->
                </div>
                
                <!-- Empty State -->
                <div class="player-management-empty-state" id="players-empty-state" style="display: none;">
                    <i class="fas fa-users"></i>
                    <p>No players found. Add your first player to get started!</p>
                    <button class="add-player-btn" style="margin-top: 20px; width: auto;" id="add-first-player-btn">
                        <i class="fas fa-plus"></i> Add First Player
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics-tab">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-bar"></i> Attendance by Position</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="positionChart"></canvas>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-line"></i> Weekly Attendance Trend</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <h2><i class="fas fa-star"></i> Top Performers This Month</h2>
                </div>
                <div class="players-grid" id="top-attendees-grid">
                    <!-- Top attendees will be inserted here -->
                </div>
            </div>
        </div>
        
        <div class="dashboard-footer">
            <p> 2024 Pro Football Training System  Professional football club management platform</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">All data is securely stored in your browser's local storage</p>
        </div>
    </div>
    
    <!-- Add/Edit Player Modal -->
    <div class="modal" id="player-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Player</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form class="modal-form" id="player-form">
                <input type="hidden" id="player-id">
                
                <div class="form-group">
                    <label for="player-name">Full Name *</label>
                    <input type="text" id="player-name" placeholder="Enter player's full name" required>
                </div>
                
                <div class="form-group">
                    <label for="player-position">Position *</label>
                    <select id="player-position" required>
                        <option value="">Select Position</option>
                        <option value="Goalkeeper">Goalkeeper</option>
                        <option value="Defender">Defender</option>
                        <option value="Midfielder">Midfielder</option>
                        <option value="Forward">Forward</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="jersey-number">Jersey Number *</label>
                    <input type="number" id="jersey-number" min="1" max="99" placeholder="1-99" required>
                </div>
                
                <div class="form-group">
                    <label>Player Photo</label>
                    <div class="image-upload" id="image-upload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload player photo</p>
                        <span>JPG or PNG, max 2MB</span>
                    </div>
                    <input type="file" id="player-photo" accept="image/*" style="display: none;">
                </div>
                
                <div class="form-group">
                    <label for="player-availability">
                        <input type="checkbox" id="player-availability" checked>
                        Always Available for Training
                    </label>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn" id="cancel-modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="save-btn">
                        <i class="fas fa-save"></i> Save Player
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API configuration
        const API_BASE_URL = 'https://attendance-system-xrp6.onrender.com/api';
        let authToken = localStorage.getItem('authToken') || null;
        let currentUser = JSON.parse(localStorage.getItem('user')) || null;

        // Player data structure
        let players = [];
        let attendanceRecords = [];
        let allAttendanceRecords = [];
        let currentSession = "morning";
        let editingPlayerId = null;
        let activeAttendanceModal = null;
        
        // Pagination variables for attendance history
        let currentPage = 1;
        const recordsPerPage = 10;
        let filteredRecords = [];
        
        // Player management variables
        let currentSort = 'name';
        let sortAscending = true;
        let searchQuery = '';
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Detect mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                document.body.classList.add('mobile-device');
                
                // Optimize date inputs for mobile
                const dateInputs = document.querySelectorAll('input[type="date"]');
                dateInputs.forEach(input => {
                    input.setAttribute('placeholder', 'Select date');
                    input.style.minHeight = '44px';
                    input.style.fontSize = '16px';
                });
                
                // Improve dropdowns for mobile
                const selects = document.querySelectorAll('select');
                selects.forEach(select => {
                    select.style.minHeight = '44px';
                    select.style.fontSize = '16px';
                });
                
                // Add touch feedback for buttons
                const buttons = document.querySelectorAll('button');
                buttons.forEach(button => {
                    button.addEventListener('touchstart', function() {
                        this.style.opacity = '0.8';
                    });
                    
                    button.addEventListener('touchend', function() {
                        this.style.opacity = '1';
                    });
                    
                    button.addEventListener('touchcancel', function() {
                        this.style.opacity = '1';
                    });
                });
                
                // Prevent zoom on double tap
                document.addEventListener('touchstart', function(event) {
                    if (event.touches.length > 1) {
                        event.preventDefault();
                    }
                }, { passive: false });
            }
            
            // Handle viewport height on mobile browsers
            function setVH() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            
            setVH();
            window.addEventListener('resize', setVH);
            window.addEventListener('orientationchange', setVH);
            
            // Set up event listeners for login
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            
            // Check if user is already logged in
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                showDashboard();
            } else {
                showLogin();
            }
            
            // Set current date
            updateCurrentDate();
        });
        
        // API helper functions
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };

            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            try {
                const response = await fetch(url, {
                    ...options,
                    headers
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        // Token expired or invalid
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('user');
                        showLogin();
                        throw new Error('Session expired. Please login again.');
                    }
                    const error = await response.json();
                    throw new Error(error.message || 'API request failed');
                }

                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                showNotification(error.message || 'Network error. Please try again.', 'error');
                throw error;
            }
        }
        
        // Show login page
        function showLogin() {
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('dashboard-container').style.display = 'none';
        }
        
        // Update current date display
        function updateCurrentDate() {
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = today.toLocaleDateString('en-US', options);
            document.getElementById('training-date').valueAsDate = today;
        }
        
        // Show dashboard and initialize everything
        async function showDashboard() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('dashboard-container').style.display = 'block';
            
            // Update user info from localStorage
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-avatar').textContent = currentUser.name.charAt(0);
            }
            
            // Load data
            await loadData();
            
            // Set up event listeners
            setupDashboardEventListeners();
            
            // Initialize dashboard
            renderPlayersForAttendance();
            renderPlayersTable();
            renderPlayersGridView();
            await renderTopAttendees();
            await updateStats();
            createCharts();
        }
            
        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('login-error');
            
            try {
                document.querySelector('.login-btn').disabled = true;
                document.querySelector('.login-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                
                const response = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });
                
                // Store token and user info
                authToken = response.token;
                currentUser = response.user;
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('user', JSON.stringify(response.user));
                
                errorElement.style.display = 'none';
                await showDashboard();
            } catch (error) {
                errorElement.style.display = 'block';
            }finally {
                document.querySelector('.login-btn').disabled = false;
                document.querySelector('.login-btn').innerHTML =  '<i class="fas fa-sign-in-alt"></i> Login to Dashboard';
            }
        }
        
        // Handle logout
        function handleLogout() {
            if (confirm("Are you sure you want to logout?")) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('user');
                authToken = null;
                currentUser = null;
                document.getElementById('dashboard-container').style.display = 'none';
                document.getElementById('login-container').style.display = 'flex';
                document.getElementById('login-form').reset();
                document.getElementById('login-error').style.display = 'none';
            }
        }
        
        // Set up dashboard event listeners
        function setupDashboardEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', switchTab);
                tab.addEventListener('touchstart', function(e) {
                    this.style.opacity = '0.8';
                });
                tab.addEventListener('touchend', function(e) {
                    this.style.opacity = '1';
                });
            });
            
            // Session type buttons
            document.querySelectorAll('.session-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.session-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentSession = this.getAttribute('data-session');
                    document.getElementById('session-type').textContent = 
                        this.textContent.replace(' Session', '');
                    renderPlayersForAttendance();
                    updateTodayAttendance();
                });
                
                // Add touch feedback
                btn.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                });
                btn.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
            
            // Training date change
            document.getElementById('training-date').addEventListener('change', function() {
                renderPlayersForAttendance();
                updateTodayAttendance();
            });
            
            // Save attendance button
            document.getElementById('save-attendance-btn').addEventListener('click', saveAttendance);
            
            // Add player button
            document.getElementById('add-player-btn').addEventListener('click', openAddPlayerModal);
            document.getElementById('add-first-player-btn')?.addEventListener('click', openAddPlayerModal);
            
            // Image upload
            document.getElementById('image-upload').addEventListener('click', function() {
                document.getElementById('player-photo').click();
            });
            
            document.getElementById('player-photo').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const fileName = e.target.files[0].name;
                    document.getElementById('image-upload').innerHTML = `
                        <i class="fas fa-check-circle" style="color: #2e8b57;"></i>
                        <p>${fileName}</p>
                        <span>Photo selected</span>
                    `;
                }
            });
            
            // Modal buttons
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('cancel-modal').addEventListener('click', closeModal);
            document.getElementById('player-form').addEventListener('submit', savePlayer);
            
            // Close modal when clicking outside
            document.getElementById('player-modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            // Close attendance modals when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (activeAttendanceModal && !e.target.closest('.attendance-modal') && 
                    !e.target.closest('.player-action-btn')) {
                    activeAttendanceModal.style.display = 'none';
                    activeAttendanceModal = null;
                }
            });
            
            // Touch events for closing modals
            document.addEventListener('touchstart', function(e) {
                if (activeAttendanceModal && !e.target.closest('.attendance-modal') && 
                    !e.target.closest('.player-action-btn')) {
                    activeAttendanceModal.style.display = 'none';
                    activeAttendanceModal = null;
                }
            });
            
            // Attendance history filter listeners
            document.getElementById('apply-filter').addEventListener('click', applyAttendanceFilters);
            document.getElementById('reset-filter').addEventListener('click', resetAttendanceFilters);
            
            // Pagination listeners
            document.getElementById('prev-page').addEventListener('click', goToPrevPage);
            document.getElementById('next-page').addEventListener('click', goToNextPage);
            
            // Player management search
            const searchInput = document.getElementById('player-search-input');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    searchQuery = this.value.toLowerCase();
                    renderPlayersGridView();
                    renderPlayersTable();
                });
            }
            
            // Player management sort buttons
            document.querySelectorAll('.player-management-sort-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const sortType = this.getAttribute('data-sort');
                    
                    // Update active sort button
                    document.querySelectorAll('.player-management-sort-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Toggle ascending/descending if clicking same sort
                    if (currentSort === sortType) {
                        sortAscending = !sortAscending;
                        this.classList.toggle('asc', sortAscending);
                        this.classList.toggle('desc', !sortAscending);
                    } else {
                        currentSort = sortType;
                        sortAscending = true;
                    }
                    
                    // Update button icon
                    const icon = this.querySelector('i');
                    if (icon) {
                        icon.className = sortAscending ? 'fas fa-sort-down' : 'fas fa-sort-up';
                    }
                    
                    renderPlayersGridView();
                    renderPlayersTable();
                });
            });
            
            // Add loading state for better UX on slow connections
            const saveButtons = document.querySelectorAll('.save-btn, .save-attendance-btn');
            saveButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.disabled) return;
                    
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    
                    if (isMobile) {
                        const originalHTML = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                        this.disabled = true;
                        
                        this.setAttribute('data-original', originalHTML);
                        
                        // Auto-restore after 10 seconds (safety)
                        setTimeout(() => {
                            if (this.disabled) {
                                this.disabled = false;
                                this.innerHTML = originalHTML;
                                showNotification('Operation timed out. Please try again.', 'error');
                            }
                        }, 10000);
                    }
                });
            });
            
            // Handle orientation change
            window.addEventListener('orientationchange', function() {
                // Update charts on orientation change
                setTimeout(() => {
                    if (window.positionChart) window.positionChart.resize();
                    if (window.trendChart) window.trendChart.resize();
                }, 300);
            });
        }
        
        // Helper function to restore button states
        window.restoreButtonState = function(button) {
            if (button) {
                button.disabled = false;
                const original = button.getAttribute('data-original');
                if (original) button.innerHTML = original;
            }
        };
        
        // Load data from API
        async function loadData() {
            try {
                // Load players
                const playersResponse = await apiRequest('/players');
                players = playersResponse;
                
                // Load today's attendance
                const today = new Date().toISOString().split('T')[0];
                const attendanceResponse = await apiRequest(`/attendance?date=${today}`);
                attendanceRecords = attendanceResponse;
                
                // Load all attendance records with timestamps
                const allAttendanceResponse = await apiRequest('/attendance');
                allAttendanceRecords = allAttendanceResponse;
                
                // Update dashboard stats
                await updateStats();
            } catch (error) {
                console.error('Failed to load data:', error);
                showNotification('Failed to load data. Please try again.', 'error');
            }
        }
        
        // Switch tabs
        function switchTab(e) {
            const tabId = e.currentTarget.getAttribute('data-tab');
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            e.currentTarget.classList.add('active');
            
            // Show corresponding content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            // Refresh data if needed
            if (tabId === 'analytics') {
                renderTopAttendees();
                updateCharts();
            } else if (tabId === 'attendance-history') {
                loadAttendanceHistory();
            } else if (tabId === 'attendance') {
                updateTodayAttendance();
            } else if (tabId === 'players') {
                renderPlayersGridView();
            }
        }
        
        // Load and display attendance history
        async function loadAttendanceHistory() {
            try {
                // Load all attendance records if not already loaded
                if (allAttendanceRecords.length === 0) {
                    const response = await apiRequest('/attendance');
                    allAttendanceRecords = response;
                }
                
                // Populate player filter dropdown
                populatePlayerFilter();
                
                // Apply filters and render
                applyAttendanceFilters();
            } catch (error) {
                console.error('Failed to load attendance history:', error);
                showNotification('Failed to load attendance history.', 'error');
            }
        }
        
        // Populate player filter dropdown
        function populatePlayerFilter() {
            const playerFilter = document.getElementById('filter-player');
            playerFilter.innerHTML = '<option value="">All Players</option>';
            
            players.forEach(player => {
                const option = document.createElement('option');
                option.value = player._id;
                option.textContent = `${player.name} (#${player.jerseyNumber})`;
                playerFilter.appendChild(option);
            });
        }
        
        // Apply attendance filters
        function applyAttendanceFilters() {
            const dateFilter = document.getElementById('filter-date').value;
            const sessionFilter = document.getElementById('filter-session').value;
            const playerFilter = document.getElementById('filter-player').value;
            const statusFilter = document.getElementById('filter-status').value;
            
            // Filter records
            filteredRecords = allAttendanceRecords.filter(record => {
                // Date filter
                if (dateFilter) {
                    const recordDate = new Date(record.date).toISOString().split('T')[0];
                    if (recordDate !== dateFilter) return false;
                }
                
                // Session filter
                if (sessionFilter && record.session !== sessionFilter) return false;
                
                // Player filter
                if (playerFilter && record.playerId._id !== playerFilter) return false;
                
                // Status filter
                if (statusFilter && record.status !== statusFilter) return false;
                
                return true;
            });
            
            // Sort by timestamp (newest first)
            filteredRecords.sort((a, b) => {
                // If timestamps exist, use them
                if (a.timestamp && b.timestamp) {
                    return new Date(b.timestamp) - new Date(a.timestamp);
                }
                // Otherwise use date field
                return new Date(b.date) - new Date(a.date);
            });
            
            // Reset to first page
            currentPage = 1;
            
            // Render table
            renderAttendanceTable();
        }
        
        // Reset attendance filters
        function resetAttendanceFilters() {
            document.getElementById('filter-date').value = '';
            document.getElementById('filter-session').value = '';
            document.getElementById('filter-player').value = '';
            document.getElementById('filter-status').value = '';
            
            // Show all records
            filteredRecords = [...allAttendanceRecords];
            filteredRecords.sort((a, b) => {
                if (a.timestamp && b.timestamp) {
                    return new Date(b.timestamp) - new Date(a.timestamp);
                }
                return new Date(b.date) - new Date(a.date);
            });
            
            currentPage = 1;
            renderAttendanceTable();
        }
        
        // Format date and time display
        function formatDateTime(dateString, timestamp) {
            const date = timestamp ? new Date(timestamp) : new Date(dateString);
            
            // Format date
            const datePart = date.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            // Format time
            const timePart = date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            
            return { datePart, timePart };
        }
        
        // Render attendance table with pagination
        function renderAttendanceTable() {
            const tbody = document.getElementById('attendance-table-body');
            const noDataElement = document.getElementById('no-attendance-data');
            const paginationElement = document.getElementById('pagination');
            
            // Calculate pagination
            const totalRecords = filteredRecords.length;
            const totalPages = Math.ceil(totalRecords / recordsPerPage);
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = Math.min(startIndex + recordsPerPage, totalRecords);
            
            // Update total records display
            document.getElementById('total-records').textContent = totalRecords;
            
            // Show/hide no data message
            if (totalRecords === 0) {
                tbody.innerHTML = '';
                noDataElement.style.display = 'block';
                paginationElement.style.display = 'none';
                return;
            } else {
                noDataElement.style.display = 'none';
                paginationElement.style.display = 'flex';
            }
            
            // Clear table
            tbody.innerHTML = '';
            
            // Add rows for current page
            for (let i = startIndex; i < endIndex; i++) {
                const record = filteredRecords[i];
                const player = players.find(p => p._id === record.playerId._id);
                
                if (!player) continue;
                
                // Format date and time
                const { datePart, timePart } = formatDateTime(record.date, record.recordedAt);
                
                // Determine session badge class
                let sessionBadgeClass = '';
                let sessionText = '';
                switch (record.session) {
                    case 'morning':
                        sessionBadgeClass = 'session-morning';
                        sessionText = 'Morning';
                        break;
                    case 'afternoon':
                        sessionBadgeClass = 'session-afternoon';
                        sessionText = 'Afternoon';
                        break;
                    case 'evening':
                        sessionBadgeClass = 'session-evening';
                        sessionText = 'Evening';
                        break;
                }
                
                // Determine status badge class
                let statusBadgeClass = '';
                let statusText = '';
                switch (record.status) {
                    case 'present':
                        statusBadgeClass = 'status-present';
                        statusText = 'Present';
                        break;
                    case 'absent':
                        statusBadgeClass = 'status-absent';
                        statusText = 'Absent';
                        break;
                    case 'late':
                        statusBadgeClass = 'status-late';
                        statusText = 'Late';
                        break;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="datetime-cell">
                        <div class="datetime-display">
                            <div class="date-part">${datePart}</div>
                            <div class="time-part">
                                <i class="far fa-clock"></i> ${timePart}
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="session-badge ${sessionBadgeClass}">
                            <i class="fas ${record.session === 'morning' ? 'fa-sun' : record.session === 'afternoon' ? 'fa-cloud-sun' : 'fa-moon'}"></i>
                            ${sessionText}
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="player-avatar" style="width: 40px; height: 40px; font-size: 1rem;">
                                ${player.image ? `<img src="${player.image}" alt="${player.name}">` : player.name.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${player.name}</div>
                                <div style="font-size: 0.8rem; color: var(--gray-color);">ID: ${player._id.substring(0, 8)}</div>
                            </div>
                        </div>
                    </td>
                    <td>${player.position}</td>
                    <td><strong>#${player.jerseyNumber}</strong></td>
                    <td>
                        <span class="status-badge ${statusBadgeClass}">
                            <i class="fas ${record.status === 'present' ? 'fa-check' : record.status === 'absent' ? 'fa-times' : 'fa-clock'}"></i>
                            ${statusText}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            }
            
            // Update pagination controls
            updatePaginationControls(totalRecords, totalPages);
        }
        
        // Update pagination controls
        function updatePaginationControls(totalRecords, totalPages) {
            const pageInfo = document.getElementById('page-info');
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');
            
            // Update page info
            const startIndex = (currentPage - 1) * recordsPerPage + 1;
            const endIndex = Math.min(currentPage * recordsPerPage, totalRecords);
            pageInfo.textContent = `Page ${currentPage} of ${totalPages} (${startIndex}-${endIndex} of ${totalRecords})`;
            
            // Update button states
            prevButton.disabled = currentPage === 1;
            nextButton.disabled = currentPage === totalPages || totalPages === 0;
        }
        
        // Go to previous page
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderAttendanceTable();
            }
        }
        
        // Go to next page
        function goToNextPage() {
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderAttendanceTable();
            }
        }
        
        // Render players for attendance marking
        function renderPlayersForAttendance() {
            const container = document.getElementById('attendance-players-grid');
            container.innerHTML = '';
            
            const today = document.getElementById('training-date').value;
            const session = currentSession;
            
            players.forEach(player => {
                // Check if attendance already marked for today
                const existingRecord = attendanceRecords.find(record => 
                    record.playerId._id === player._id && 
                    new Date(record.date).toISOString().split('T')[0] === today && 
                    record.session === session
                );
                
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.innerHTML = `
                    <div class="player-avatar">
                        ${player.image ? `<img src="${player.image}" alt="${player.name}">` : player.name.charAt(0)}
                    </div>
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-position">${player.position}  #${player.jerseyNumber}</div>
                        <div class="player-status">
                            <div class="status-dot ${player.alwaysAvailable ? 'status-available' : 'status-unavailable'}"></div>
                            <span>${player.alwaysAvailable ? 'Always Available' : 'Available on Request'}</span>
                        </div>
                    </div>
                    <button class="player-action-btn" data-player-id="${player._id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <div class="attendance-modal" id="modal-${player._id}">
                        <h4>Mark Attendance for ${player.name}</h4>
                        <div class="attendance-options">
                            <button class="attendance-btn btn-present ${existingRecord?.status === 'present' ? 'active' : ''}" 
                                    data-player-id="${player._id}" data-status="present">
                                <i class="fas fa-check"></i> Present
                            </button>
                            <button class="attendance-btn btn-absent ${existingRecord?.status === 'absent' ? 'active' : ''}" 
                                    data-player-id="${player._id}" data-status="absent">
                                <i class="fas fa-times"></i> Absent
                            </button>
                            <button class="attendance-btn btn-late ${existingRecord?.status === 'late' ? 'active' : ''}" 
                                    data-player-id="${player._id}" data-status="late">
                                <i class="fas fa-clock"></i> Late
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(playerCard);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.player-action-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const playerId = this.getAttribute('data-player-id');
                    const modal = document.getElementById(`modal-${playerId}`);
                    
                    // Close any open modal
                    if (activeAttendanceModal && activeAttendanceModal !== modal) {
                        activeAttendanceModal.style.display = 'none';
                    }
                    
                    // Toggle current modal
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                        activeAttendanceModal = null;
                    } else {
                        modal.style.display = 'block';
                        activeAttendanceModal = modal;
                    }
                });
                
                // Touch feedback
                btn.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.9)';
                });
                btn.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
            
            // Add event listeners to attendance buttons inside modals
            document.querySelectorAll('.attendance-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const playerId = this.getAttribute('data-player-id');
                    const status = this.getAttribute('data-status');
                    
                    // Update the clicked button's appearance
                    const modal = this.closest('.attendance-modal');
                    modal.querySelectorAll('.attendance-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Store attendance locally
                    const today = document.getElementById('training-date').value;
                    const session = currentSession;
                    
                    // Remove existing record for this player/date/session
                    attendanceRecords = attendanceRecords.filter(record => 
                        !(record.playerId._id === playerId && 
                        new Date(record.date).toISOString().split('T')[0] === today && 
                        record.session === session)
                    );
                    
                    // Add new record
                    attendanceRecords.push({
                        playerId: { _id: playerId },
                        date: today,
                        session,
                        status
                    });
                    
                    // Close modal after selection
                    setTimeout(() => {
                        modal.style.display = 'none';
                        activeAttendanceModal = null;
                    }, 500);
                    
                    // Update today's attendance display
                    updateTodayAttendance();
                });
            });
        }
        
        // Update today's attendance display
        function updateTodayAttendance() {
            const today = document.getElementById('training-date').value;
            const session = currentSession;
            
            // Get today's attendance records
            const todayRecords = attendanceRecords.filter(record => 
                new Date(record.date).toISOString().split('T')[0] === today && 
                record.session === session
            );
            
            // Count attendance types
            const presentCount = todayRecords.filter(r => r.status === 'present').length;
            const absentCount = todayRecords.filter(r => r.status === 'absent').length;
            const lateCount = todayRecords.filter(r => r.status === 'late').length;
            
            // Update counts
            document.getElementById('present-count').textContent = presentCount;
            document.getElementById('absent-count').textContent = absentCount;
            document.getElementById('late-count').textContent = lateCount;
            
            // Show players who attended today
            const container = document.getElementById('today-attendance-grid');
            container.innerHTML = '';

            if (todayRecords.length === 0) {
                container.innerHTML = '<tr><td colspan="4" style="color: var(--gray-color); text-align: center; padding: 30px;">No attendance marked for today yet.</td></tr>';
                document.getElementById('today-attendance-section').style.display = 'none';
                return;
            }

            // Show the section
            document.getElementById('today-attendance-section').style.display = 'block';
            document.getElementById('today-attendance-section').style.width = '100%';

            // Create table structure
            container.innerHTML = `
                <table style="width: 100%; overflow: auto; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <thead>
                        <tr style="background-color: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                            <th style="padding: 16px; text-align: left; color: var(--primary-color); font-weight: 600;">Player Name</th>
                            <th style="padding: 16px; text-align: left; color: var(--primary-color); font-weight: 600;">Position</th>
                            <th style="padding: 16px; text-align: left; color: var(--primary-color); font-weight: 600;">Jersey</th>
                            <th style="padding: 16px; text-align: left; color: var(--primary-color); font-weight: 600;">Status</th>
                        </tr>
                    </thead>
                    <tbody id="today-attendance-body">
                    </tbody>
                </table>
            `;

            const tableBody = document.getElementById('today-attendance-body');
            
            // Add players who attended
            todayRecords.forEach(record => {
                const player = players.find(p => p._id === record.playerId._id);
                
                if (player) {
                    let statusIcon = '';
                    let statusText = '';
                    let statusColor = '';
                    
                    if (record.status === 'present') {
                        statusIcon = 'fa-check';
                        statusText = 'Present';
                        statusColor = '#2e8b57';
                    } else if (record.status === 'absent') {
                        statusIcon = 'fa-times';
                        statusText = 'Absent';
                        statusColor = '#c5221f';
                    } else if (record.status === 'late') {
                        statusIcon = 'fa-clock';
                        statusText = 'Late';
                        statusColor = '#b06000';
                    }
                    
                    const row = document.createElement('tr');
                    row.style.borderBottom = '1px solid #f1f5f9';
                    row.innerHTML = `
                        <td style="padding: 16px; font-weight: 500;">${player.name}</td>
                        <td style="padding: 16px;">
                            <span style="color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">
                                ${player.position}
                            </span>
                        </td>
                        <td style="padding: 16px;">
                            <span style="font-weight: 700; color: var(--dark-color);">#${player.jerseyNumber}</span>
                        </td>
                        <td style="padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas ${statusIcon}" style="color: ${statusColor};"></i>
                                <span style="color: ${statusColor}; font-weight: 600;">${statusText}</span>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                }
            });
        }
        
        // Save attendance to API
        async function saveAttendance() {
            const today = document.getElementById('training-date').value;
            const session = currentSession;
            
            // Get all attendance records for today's session
            const todayRecords = attendanceRecords.filter(record => 
                new Date(record.date).toISOString().split('T')[0] === today && 
                record.session === session
            );
            
            const attendanceData = todayRecords.map(record => ({
                playerId: record.playerId._id,
                status: record.status
            }));
            
            if (attendanceData.length === 0) {
                showNotification('No attendance records to save. Please mark attendance first.', 'error');
                return;
            }
            
            try {
                // Show loading animation
                document.getElementById('save-attendance-btn').disabled = true;
                document.getElementById('save-attendance-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                
                // Save attendance to API with timestamp
                await apiRequest('/attendance', {
                    method: 'POST',
                    body: JSON.stringify({
                        date: today,
                        session,
                        attendanceData,
                        timestamp: new Date().toISOString()
                    })
                });
                
                showNotification('Attendance saved successfully!', 'success');
                
                // Reload data
                await loadData();
                renderPlayersForAttendance();
                renderPlayersTable();
                renderPlayersGridView();
                await renderTopAttendees();
                await updateStats();
                updateTodayAttendance();
                
                // Refresh attendance history if on that tab
                if (document.getElementById('attendance-history-tab').classList.contains('active')) {
                    loadAttendanceHistory();
                }
            } catch (error) {
                console.error('Failed to save attendance:', error);
            } finally {
                restoreButtonState(document.getElementById('save-attendance-btn'));
                document.getElementById('save-attendance-btn').innerHTML = '<i class="fas fa-save"></i> Save Attendance';
            }
        }
        
        // Show notification
        function showNotification(message, type) {
            // Remove existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Add styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${type === 'success' ? '#2e8b57' : '#cd5c5c'};
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
                display: flex;
                align-items: center;
                gap: 12px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: calc(100vw - 40px);
                word-break: break-word;
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Sort players based on current sort settings
        function sortPlayers(playerList) {
            return playerList.sort((a, b) => {
                let valueA, valueB;
                
                switch (currentSort) {
                    case 'name':
                        valueA = a.name.toLowerCase();
                        valueB = b.name.toLowerCase();
                        break;
                    case 'position':
                        valueA = a.position.toLowerCase();
                        valueB = b.position.toLowerCase();
                        break;
                    case 'jersey':
                        valueA = parseInt(a.jerseyNumber);
                        valueB = parseInt(b.jerseyNumber);
                        break;
                    case 'attendance':
                        const rateA = a.totalSessions > 0 ? (a.attendanceCount / a.totalSessions) : 0;
                        const rateB = b.totalSessions > 0 ? (b.attendanceCount / b.totalSessions) : 0;
                        valueA = rateA;
                        valueB = rateB;
                        break;
                    case 'available':
                        valueA = a.alwaysAvailable ? 1 : 0;
                        valueB = b.alwaysAvailable ? 1 : 0;
                        break;
                    default:
                        valueA = a.name.toLowerCase();
                        valueB = b.name.toLowerCase();
                }
                
                if (valueA < valueB) return sortAscending ? -1 : 1;
                if (valueA > valueB) return sortAscending ? 1 : -1;
                return 0;
            });
        }
        
        // Filter players based on search query
        function filterPlayers(playerList) {
            if (!searchQuery) return playerList;
            
            return playerList.filter(player => {
                return (
                    player.name.toLowerCase().includes(searchQuery) ||
                    player.position.toLowerCase().includes(searchQuery) ||
                    player.jerseyNumber.toString().includes(searchQuery)
                );
            });
        }
        
        // Render players table (desktop)
        function renderPlayersTable() {
            const tbody = document.getElementById('players-table-body');
            tbody.innerHTML = '';
            
            // Filter and sort players
            let filteredPlayers = filterPlayers([...players]);
            filteredPlayers = sortPlayers(filteredPlayers);
            
            // Show/hide empty state
            const emptyState = document.getElementById('players-empty-state');
            if (filteredPlayers.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            } else {
                emptyState.style.display = 'none';
            }
            
            filteredPlayers.forEach(player => {
                const attendanceRate = player.totalSessions > 0 
                    ? Math.round((player.attendanceCount / player.totalSessions) * 100) 
                    : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="player-avatar" style="width: 50px; height: 50px; font-size: 1.1rem;">
                                ${player.image ? `<img src="${player.image}" alt="${player.name}">` : player.name.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${player.name}</div>
                                <div style="font-size: 0.85rem; color: var(--gray-color);">ID: ${player._id.substring(0, 8)}</div>
                            </div>
                        </div>
                    </td>
                    <td>${player.position}</td>
                    <td><strong>#${player.jerseyNumber}</strong></td>
                    <td>
                        <div class="availability-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" ${player.alwaysAvailable ? 'checked' : ''} 
                                    onchange="togglePlayerAvailability('${player._id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>${player.alwaysAvailable ? 'Yes' : 'No'}</span>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="flex: 1; height: 10px; background-color: #f1f5f9; border-radius: 5px;">
                                <div style="width: ${attendanceRate}%; height: 100%; background-color: ${attendanceRate >= 90 ? '#2e8b57' : attendanceRate >= 70 ? '#daa520' : '#cd5c5c'}; border-radius: 5px;"></div>
                            </div>
                            <span style="font-weight: 600; color: ${attendanceRate >= 90 ? '#2e8b57' : attendanceRate >= 70 ? '#daa520' : '#cd5c5c'}">${attendanceRate}%</span>
                        </div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="edit-btn" onclick="editPlayer('${player._id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button id='delete-btn-${player._id}' class="delete-btn" onclick="deletePlayer('${player._id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Render players grid view (mobile)
        function renderPlayersGridView() {
            const container = document.getElementById('players-grid-view');
            container.innerHTML = '';
            
            // Filter and sort players
            let filteredPlayers = filterPlayers([...players]);
            filteredPlayers = sortPlayers(filteredPlayers);
            
            // Show/hide empty state
            const emptyState = document.getElementById('players-empty-state');
            if (filteredPlayers.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            } else {
                emptyState.style.display = 'none';
            }
            
            filteredPlayers.forEach(player => {
                const attendanceRate = player.totalSessions > 0 
                    ? Math.round((player.attendanceCount / player.totalSessions) * 100) 
                    : 0;
                
                // Determine color based on attendance rate
                let progressColor = '#cd5c5c'; // Default red for low attendance
                if (attendanceRate >= 90) {
                    progressColor = '#2e8b57'; // Green for high attendance
                } else if (attendanceRate >= 70) {
                    progressColor = '#daa520'; // Yellow for medium attendance
                }
                
                const playerCard = document.createElement('div');
                playerCard.className = 'player-management-card';
                playerCard.innerHTML = `
                    <div class="player-management-header-row">
                        <div class="player-management-avatar">
                            ${player.image ? `<img src="${player.image}" alt="${player.name}">` : player.name.charAt(0)}
                        </div>
                        <div class="player-management-info">
                            <div class="player-management-name">${player.name}</div>
                            <div class="player-management-details">
                                Player ID: <strong>${player._id.substring(0, 8)}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="player-management-card-content">
                        <div class="player-management-detail-item">
                            <span class="player-management-label">Position</span>
                            <span class="player-management-value">${player.position}</span>
                        </div>
                        <div class="player-management-detail-item">
                            <span class="player-management-label">Jersey No.</span>
                            <span class="player-management-value">#${player.jerseyNumber}</span>
                        </div>
                    </div>
                    
                    <div class="player-management-availability">
                        <span class="player-management-label">Always Available</span>
                        <label class="toggle-switch">
                            <input type="checkbox" ${player.alwaysAvailable ? 'checked' : ''} 
                                onchange="togglePlayerAvailability('${player._id}', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="player-management-attendance">
                        <div class="player-management-attendance-header">
                            <span class="player-management-label">Attendance Rate</span>
                            <span class="player-management-attendance-rate" style="color: ${progressColor}">${attendanceRate}%</span>
                        </div>
                        <div class="player-management-progress-bar">
                            <div class="player-management-progress-fill" style="width: ${attendanceRate}%; background-color: ${progressColor};"></div>
                        </div>
                    </div>
                    
                    <div class="player-management-actions">
                        <button class="player-management-edit-btn" onclick="editPlayer('${player._id}')">
                            <i class="fas fa-edit"></i> Edit Player
                        </button>
                        <button class="player-management-delete-btn" onclick="deletePlayer('${player._id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                container.appendChild(playerCard);
            });
            
            // Add touch feedback for mobile cards
            document.querySelectorAll('.player-management-edit-btn, .player-management-delete-btn').forEach(btn => {
                btn.addEventListener('touchstart', function() {
                    this.style.opacity = '0.8';
                });
                btn.addEventListener('touchend', function() {
                    this.style.opacity = '1';
                });
            });
        }
        
        // Toggle player availability
        async function togglePlayerAvailability(playerId, isAvailable) {
            try {
                await apiRequest(`/players/${playerId}/availability`, {
                    method: 'PATCH',
                    body: JSON.stringify({ alwaysAvailable: isAvailable })
                });
                
                // Update local data
                const player = players.find(p => p._id === playerId);
                if (player) {
                    player.alwaysAvailable = isAvailable;
                }
                
                renderPlayersTable();
                renderPlayersGridView();
                renderPlayersForAttendance();
                await updateStats();
                showNotification('Player availability updated!', 'success');
            } catch (error) {
                console.error('Failed to update player availability:', error);
            }
        }
        
        // Open add player modal
        function openAddPlayerModal() {
            editingPlayerId = null;
            document.getElementById('modal-title').textContent = 'Add New Player';
            document.getElementById('player-form').reset();
            document.getElementById('player-availability').checked = true;
            document.getElementById('image-upload').innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload player photo</p>
                <span>JPG or PNG, max 2MB</span>
            `;
            document.getElementById('player-modal').style.display = 'flex';
        }
        
        // Edit player
        function editPlayer(playerId) {
            const player = players.find(p => p._id === playerId);
            if (player) {
                editingPlayerId = playerId;
                document.getElementById('modal-title').textContent = 'Edit Player';
                document.getElementById('player-id').value = player._id;
                document.getElementById('player-name').value = player.name;
                document.getElementById('player-position').value = player.position;
                document.getElementById('jersey-number').value = player.jerseyNumber;
                document.getElementById('player-availability').checked = player.alwaysAvailable;
                
                if (player.image) {
                    document.getElementById('image-upload').innerHTML = `
                        <i class="fas fa-check-circle" style="color: #2e8b57;"></i>
                        <p>Photo uploaded</p>
                        <span>Click to change</span>
                    `;
                } else {
                    document.getElementById('image-upload').innerHTML = `
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload player photo</p>
                        <span>JPG or PNG, max 2MB</span>
                    `;
                }
                
                document.getElementById('player-modal').style.display = 'flex';
            }
        }
        
        // Delete player
        async function deletePlayer(playerId) {
            if (confirm("Are you sure you want to delete this player? This action cannot be undone.")) {
                // Show loading animation
                try {
                    // Find and update both desktop and mobile delete buttons
                    const desktopDeleteBtn = document.getElementById(`delete-btn-${playerId}`);
                    const mobileDeleteBtn = document.querySelector(`.player-management-delete-btn[onclick="deletePlayer('${playerId}')"]`);
                    
                    if (desktopDeleteBtn) {
                        desktopDeleteBtn.disabled = true;
                        desktopDeleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
                    }
                    
                    if (mobileDeleteBtn) {
                        mobileDeleteBtn.disabled = true;
                        mobileDeleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
                    }
                    
                    await apiRequest(`/players/${playerId}`, {
                        method: 'DELETE'
                    });
                    
                    // Update local data
                    players = players.filter(p => p._id !== playerId);
                    attendanceRecords = attendanceRecords.filter(record => record.playerId._id !== playerId);
                    allAttendanceRecords = allAttendanceRecords.filter(record => record.playerId._id !== playerId);
                    
                    renderPlayersTable();
                    renderPlayersGridView();
                    renderPlayersForAttendance();
                    await renderTopAttendees();
                    await updateStats();
                    updateTodayAttendance();
                    
                    // Refresh attendance history if on that tab
                    if (document.getElementById('attendance-history-tab').classList.contains('active')) {
                        loadAttendanceHistory();
                    }
                    
                    showNotification('Player deleted successfully!', 'success');
                } catch (error) {
                    console.error('Failed to delete player:', error);
                    showNotification('Failed to delete player', 'error');
                } finally {
                    // Restore button states
                    const desktopDeleteBtn = document.getElementById(`delete-btn-${playerId}`);
                    const mobileDeleteBtn = document.querySelector(`.player-management-delete-btn[onclick="deletePlayer('${playerId}')"]`);
                    
                    if (desktopDeleteBtn) {
                        desktopDeleteBtn.disabled = false;
                        desktopDeleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete';
                    }
                    
                    if (mobileDeleteBtn) {
                        mobileDeleteBtn.disabled = false;
                        mobileDeleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete';
                    }
                }
            }
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('player-modal').style.display = 'none';
            document.getElementById('player-form').reset();
            document.getElementById('player-photo').value = '';
        }
        
        // Save player (add or edit)
        async function savePlayer(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('name', document.getElementById('player-name').value);
            formData.append('position', document.getElementById('player-position').value);
            formData.append('jerseyNumber', document.getElementById('jersey-number').value);
            formData.append('alwaysAvailable', document.getElementById('player-availability').checked);
            
            const imageInput = document.getElementById('player-photo');
            if (imageInput.files[0]) {
                formData.append('image', imageInput.files[0]);
            }
            
            // If editing and image was removed, send removeImage flag
            if (editingPlayerId && !imageInput.files[0]) {
                const player = players.find(p => p._id === editingPlayerId);
                if (player && player.image && !imageInput.files[0]) {
                    // Check if user wants to remove existing image
                    formData.append('removeImage', 'true');
                }
            }
            
            try {
                // Show loading animation
                const saveBtn = document.querySelector('.save-btn');
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                
                let response;
                if (editingPlayerId) {
                    // Update player
                    response = await fetch(`${API_BASE_URL}/players/${editingPlayerId}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: formData
                    });
                } else {
                    // Add new player
                    response = await fetch(`${API_BASE_URL}/players`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: formData
                    });
                }
                
                if (!response.ok) {
                    throw new Error('Failed to save player');
                }
                
                const savedPlayer = await response.json();
                
                // Update local data
                if (editingPlayerId) {
                    const index = players.findIndex(p => p._id === editingPlayerId);
                    if (index !== -1) {
                        players[index] = savedPlayer;
                    }
                } else {
                    players.push(savedPlayer);
                }
                
                closeModal();
                renderPlayersTable();
                renderPlayersGridView();
                renderPlayersForAttendance();
                await renderTopAttendees();
                await updateStats();
                
                // Refresh attendance history if on that tab
                if (document.getElementById('attendance-history-tab').classList.contains('active')) {
                    loadAttendanceHistory();
                }
                
                showNotification(editingPlayerId ? 'Player updated successfully!' : 'Player added successfully!', 'success');
            } catch (error) {
                console.error('Failed to save player:', error);
                showNotification('Failed to save player', 'error');
            } finally {
                const saveBtn = document.querySelector('.save-btn');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Player';
            }
        }
        
        // Render top attendees
        async function renderTopAttendees() {
            try {
                const topPerformers = await apiRequest('/analytics/top-performers?limit=6');
                const container = document.getElementById('top-attendees-grid');
                container.innerHTML = '';
                
                topPerformers.forEach(player => {
                    const playerCard = document.createElement('div');
                    playerCard.className = 'player-card';
                    playerCard.innerHTML = `
                        <div class="player-avatar">
                            ${player.image ? `<img src="${player.image}" alt="${player.name}">` : player.name.charAt(0)}
                        </div>
                        <div class="player-info">
                            <div class="player-name">${player.name}</div>
                            <div class="player-position">${player.position}  #${player.jerseyNumber}</div>
                            <div style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-size: 0.9rem; color: var(--gray-color);">Attendance Rate</div>
                                    <div style="font-weight: 700; color: ${player.attendanceRate >= 90 ? '#2e8b57' : player.attendanceRate >= 70 ? '#daa520' : '#cd5c5c'}">${player.attendanceRate}%</div>
                                </div>
                                <div style="height: 8px; background-color: #f1f5f9; border-radius: 4px; margin-top: 8px;">
                                    <div style="width: ${player.attendanceRate}%; height: 100%; background-color: ${player.attendanceRate >= 90 ? '#2e8b57' : player.attendanceRate >= 70 ? '#daa520' : '#cd5c5c'}; border-radius: 4px;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(playerCard);
                });
            } catch (error) {
                console.error('Failed to load top performers:', error);
            }
        }
        
        // Update statistics
        async function updateStats() {
            try {
                const dashboardStats = await apiRequest('/analytics/dashboard');
                
                // Update dashboard stats
                document.getElementById('total-players').textContent = dashboardStats.totalPlayers;
                document.getElementById('available-players').textContent = dashboardStats.availablePlayers;
                document.getElementById('attendance-rate').textContent = dashboardStats.attendanceRate;
                document.getElementById('sessions-month').textContent = dashboardStats.sessionsThisMonth;
            } catch (error) {
                console.error('Failed to load dashboard stats:', error);
            }
        }
        
        // Create charts
        function createCharts() {
            // Attendance by position chart
            const positionCtx = document.getElementById('positionChart').getContext('2d');
            window.positionChart = new Chart(positionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Goalkeeper', 'Defender', 'Midfielder', 'Forward'],
                    datasets: [{
                        data: [88, 82, 94, 90],
                        backgroundColor: [
                            'rgba(74, 111, 165, 0.8)',
                            'rgba(46, 139, 87, 0.8)',
                            'rgba(218, 165, 32, 0.8)',
                            'rgba(205, 92, 92, 0.8)'
                        ],
                        borderColor: [
                            'rgb(74, 111, 165)',
                            'rgb(46, 139, 87)',
                            'rgb(218, 165, 32)',
                            'rgb(205, 92, 92)'
                        ],
                        borderWidth: 2,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Attendance: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
            
            // Weekly trend chart
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            window.trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],
                    datasets: [{
                        label: 'Attendance Rate',
                        data: [85, 88, 90, 92, 94],
                        backgroundColor: 'rgba(30, 60, 114, 0.1)',
                        borderColor: 'rgb(30, 60, 114)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: 'rgb(42, 82, 152)',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Attendance: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 70,
                            max: 100,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: {
                                    size: 11
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update charts with real data
        async function updateCharts() {
            try {
                // Get position data
                const positionData = await apiRequest('/analytics/position');
                if (positionData && positionData.length > 0) {
                    const labels = positionData.map(item => item.position);
                    const data = positionData.map(item => Math.round(item.attendanceRate));
                    
                    window.positionChart.data.labels = labels;
                    window.positionChart.data.datasets[0].data = data;
                    window.positionChart.update();
                }
                
                // Get trend data
                const trendData = await apiRequest('/analytics/weekly-trend');
                if (trendData && trendData.length > 0) {
                    const labels = trendData.map((item, index) => `Week ${index + 1}`);
                    const data = trendData.map(item => Math.round(item.attendanceRate));
                    
                    window.trendChart.data.labels = labels;
                    window.trendChart.data.datasets[0].data = data;
                    window.trendChart.update();
                }
            } catch (error) {
                console.error('Failed to update charts:', error);
            }
        }
        
        // Initialize today's attendance on load
        setTimeout(() => {
            if (document.getElementById('dashboard-container').style.display === 'block') {
                updateTodayAttendance();
            }
        }, 100);
        
        // Add pull-to-refresh prevention for mobile
        let touchStartY = 0;
        document.addEventListener('touchstart', e => {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchmove', e => {
            // Prevent pull-to-refresh when scrolling up at the top
            const touchY = e.touches[0].clientY;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop === 0 && touchY > touchStartY) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>